<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人博客"><meta name="keywords" content="python, linux, mysql, django, 前端, css, javascript, html"><title>flask模型关系与钩子函数 | NKactor</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">flask模型关系与钩子函数</h1><a id="logo" href="/.">NKactor</a><p class="description">笨鸟先飞，滴水穿石</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">flask模型关系与钩子函数</h1><div class="post-meta"><a href="/2018/12/20/flask模型关系与钩子函数/#comments" class="comment-count"></a><p><span class="date">Dec 20, 2018</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><center><strong>flask中定义模型和模型间关系与钩子函数介绍</strong></center>

<h2 id="一、模型关系定义"><a href="#一、模型关系定义" class="headerlink" title="一、模型关系定义"></a>一、模型关系定义</h2><h3 id="1-1-一对多"><a href="#1-1-一对多" class="headerlink" title="1.1 一对多"></a>1.1 一对多</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>, autoincrement=<span class="keyword">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">20</span>), unique=<span class="keyword">True</span>, nullable=<span class="keyword">True</span>)</span><br><span class="line">    grade_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'tb_grade.id'</span>), nullable=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">    __tablename__ = <span class="string">"tb_student"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grade</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>, autoincrement=<span class="keyword">True</span>)</span><br><span class="line">    g_name = db.Column(db.String(<span class="number">10</span>), unique=<span class="keyword">True</span>, nullable=<span class="keyword">False</span>)</span><br><span class="line">    stus = db.relationship(<span class="string">'Student'</span>, backref=<span class="string">'g'</span>)</span><br><span class="line">    <span class="comment"># backref 反向引用</span></span><br><span class="line"></span><br><span class="line">    __tablename__ = <span class="string">'tb_grade'</span></span><br></pre></td></tr></table></figure>
<pre><code>db.Column(db.Integer, db.ForeignKey(&apos;tb_grade.id&apos;), nullable=True) 创建外键关联关系，外键一般在多的一方
db.relationship(&apos;Student&apos;, backref=&apos;g&apos;)  通过relationship(&apos;模型名&apos;，backref=&apos;字符&apos;) 
relationship() 中第一个参数是模型名，
brakref 反向引用（在多查一时使用该参数）
</code></pre><p>&emsp;&emsp;一对多关系中的查询操作</p>
<pre><code># 查询班级
grade = Grade.query.filter(Grade.g_name==&apos;python001&apos;).first()
# 通过班级查询学生
students = grade.stus


stus = Student.query.get(1)
# 通过学生查询班级
grade = stus.g
</code></pre><h3 id="1-2-一对一"><a href="#1-2-一对一" class="headerlink" title="1.2 一对一"></a>1.2 一对一</h3><pre><code>一对一关系也就是在一对多关系中将relationship中添加
uselist = True 
也可以在外键中添加唯一约束
unique = True
</code></pre><h3 id="1-3-多对多"><a href="#1-3-多对多" class="headerlink" title="1.3 多对多"></a>1.3 多对多</h3><p>&emsp;&emsp;创建多对多关系</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">	<span class="comment"># 创建学生模型</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>, autoincrement=<span class="keyword">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">20</span>), unique=<span class="keyword">True</span>, nullable=<span class="keyword">True</span>)</span><br><span class="line">    grade_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'tb_grade.id'</span>), nullable=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">    __tablename__ = <span class="string">"tb_student"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建第三张表</span></span><br><span class="line">s_c = db.Table(<span class="string">'s_c'</span>,</span><br><span class="line">               db.Column(<span class="string">'s_id'</span>, db.Integer, db.ForeignKey(<span class="string">'tb_student.id'</span>)),</span><br><span class="line">               db.Column(<span class="string">'c_id'</span>, db.Integer, db.ForeignKey(<span class="string">'tb_course.id'</span>)),</span><br><span class="line">               )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Course</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">	<span class="comment"># 创建课程模型</span></span><br><span class="line">    __tablename__ = <span class="string">'tb_course'</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>, autoincrement=<span class="keyword">True</span>)</span><br><span class="line">    g_name = db.Column(db.String(<span class="number">10</span>), unique=<span class="keyword">True</span>, nullable=<span class="keyword">False</span>)</span><br><span class="line">    stus = db.relationship(<span class="string">'Student'</span>, secondary=s_c, backref=<span class="string">'cou'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>在多对多关系中relationship可以定义在任何一方，但是这里的relationship参数和一对多关系中的参数有些不同
格式：
    db.relationship(&apos;模型名&apos;, secondary=第三张表明, backref=&apos;反向引用字符（任意字符都行）&apos;)
如：
    stus = db.relationship(&apos;Student&apos;, secondary=s_c, backref=&apos;cou&apos;)
</code></pre><p>&emsp;&emsp;多对多关系中的查询操作</p>
<pre><code>在多对多关系中相互查询操作与一对多一样
stu = Student.query.get(1)
cou = Course.query.filter(Course.g_name==&apos;java&apos;).first()

# 学生查询课程, 返回一个由课程对象组成的列表
stu.cou
# 课程查询学生，返回一个由学生对象组成的列表
cou.stus
</code></pre><p>&emsp;&emsp;向第三张表中添加和删除数据</p>
<pre><code>在flask中维持多对多关系时，创建了第三张表但第三张表并不是一个模型，所以不能直接操作该表，这也是flask与Django在定义模型上的一点区别。

不管是通过学生查询课程还是课程查询学生，两个方法返回值都是一个列表，所以要向第三张表中插入数据就可以直接通过列表操作，实现对第三张表的操作。
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取id为1, 2的学生对象</span></span><br><span class="line">stu1 = Student.query.get(<span class="number">1</span>)</span><br><span class="line">stu2 = Student.query.get(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 获取课程名为java的课程</span></span><br><span class="line">cous = Course.query.filter(Course.g_name==<span class="string">'java'</span>).first()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给学生添加课程</span></span><br><span class="line">stu1.cou.append(cou)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给课程添加一个选课学生</span></span><br><span class="line">cous.stus.append(stu2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除第三张表的数据也可以通过列表操作实现，列表删除元素remove(元素)</span></span><br><span class="line"><span class="comment"># 删除一个选课学生</span></span><br><span class="line">cous.stus.remove(stu1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除一门学生已选课程</span></span><br><span class="line">stu2.cou.remove(cous)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后提交事务</span></span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>
<pre><code>在模型定义是relationship有一个lazy参数，

官网解释有如下几个lazy的参数：
lazy 决定了 SQLAlchemy 什么时候从数据库中加载数据:，有如下四个值:

select/True: (which is the default) means that SQLAlchemy will load the data as necessary in one go using a standard select statement.

joined/False: tells SQLAlchemy to load the relationship in the same query as the parent using a JOIN statement.

subquery: works like ‘joined’ but instead SQLAlchemy will use a subquery.

dynamic: is special and useful if you have many items. Instead of loading the items SQLAlchemy will return another query object which you can further refine before loading the items. This is usually what you want if you expect more than a handful of items for this relationship

一般常用的值如下：

lazy=select/True    就是访问到属性的时候，就会全部加载该属性的数据。

lazy=joined/False   则是在对关联的两个表进行join操作，从而获取到所有相关的对象。

lazy=dynamic        则不一样，在访问属性的时候，并没有在内存中加载数据，而是返回一个query对象，如：filter过滤、all()等
</code></pre><h2 id="二、钩子函数"><a href="#二、钩子函数" class="headerlink" title="二、钩子函数()"></a>二、钩子函数()</h2><pre><code>在flask中没有中间件概念，但是在蓝图对象（Blueprint）中提供了常用的几个装饰器类似于Django中的中间件。被这些装饰器修饰的函数就称为钩子函数。
</code></pre><h3 id="2-1-before-request"><a href="#2-1-before-request" class="headerlink" title="2.1 before_request"></a>2.1 before_request</h3><pre><code>见名知意，该装饰器装饰的函数会在请求之前调用，也就类似于Django中间件中的process_request，会对所有请求进行拦截。
注意： 在before_request中不能写return语句
因为当你的请求在before_request中就遇到return服务器就会立即响应你的请求，并没有调用相应的视图函数。
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">blue = Blueprint(<span class="string">'app'</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@blue.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">before_req</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">	print(<span class="string">'请求之前执行的代码'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>如果有多个被before_request装饰的函数，则会依次调用
</code></pre><h3 id="2-2-after-request"><a href="#2-2-after-request" class="headerlink" title="2.2 after_request"></a>2.2 after_request</h3><pre><code>after_request装饰的函数会在请求结束后调用，类似于Django中的process_response，同时after_request装饰的函数需要接收一个响应response，并且必须写return
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@blue.after_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">after_req</span><span class="params">(response)</span>:</span></span><br><span class="line"></span><br><span class="line">	print(<span class="string">'请求之后执行的代码'</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<pre><code>有多个被after_response装饰的函数会在请求后，倒序依次执行，因为请求和响应的执行过程成 U 型，先执行的请求对应的响应最后执行，后执行的请求对应的响应先执行。
</code></pre><p>&emsp;&emsp;中间件的执行简单过程</p>
<p><img src="https://upload-images.jianshu.io/upload_images/14187443-17f570125e182d9c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="中间件执行过程"></p>
<h3 id="2-3-teardown-request"><a href="#2-3-teardown-request" class="headerlink" title="2.3 teardown_request"></a>2.3 teardown_request</h3><pre><code>被该装饰器装饰的函数无论程序是否正常执行都会被调用，类似于try...except...finally 中的finally
但是，被装饰函数需要接收一个异常
我们可以将一些无论程序成功与否都要执行的操作写在这里面，如：连接数据库，我们要关闭连接
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@blue.teardown_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">teardown_req</span><span class="params">(e)</span>:</span></span><br><span class="line"></span><br><span class="line">	print(e)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<strong>注意：</strong>想要teardown_request生效需要加下面的配置</p>
<pre><code>app.config[&apos;PRESERVE_CONTEXT_ON_EXCEPTION&apos;] = False
</code></pre><h3 id="2-4-抛出异常"><a href="#2-4-抛出异常" class="headerlink" title="2.4 抛出异常"></a>2.4 抛出异常</h3><pre><code>在flask中可以用abort(异常值)，抛出一个异常
from flask import abort
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	<span class="number">1</span>/<span class="number">0</span></span><br><span class="line"><span class="keyword">except</span>：</span><br><span class="line">	abort(<span class="number">500</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-5-异常捕获"><a href="#2-5-异常捕获" class="headerlink" title="2.5 异常捕获"></a>2.5 异常捕获</h3><pre><code>异常捕获函数可以用errorhandler(异常类型)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@blue.errorhandler(500)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">error</span><span class="params">(e)</span>:</span></span><br><span class="line"></span><br><span class="line">	print(e)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> e</span><br></pre></td></tr></table></figure>
<h3 id="2-6-下面是一个连接数据库的实例"><a href="#2-6-下面是一个连接数据库的实例" class="headerlink" title="2.6 下面是一个连接数据库的实例"></a>2.6 下面是一个连接数据库的实例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@blue.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect_mysql</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="comment"># 创建连接</span></span><br><span class="line">	conn = pymysql.Connect(host=<span class="string">'127.0.0.1'</span>,</span><br><span class="line">						   port=<span class="number">3306</span>,</span><br><span class="line">						   database=<span class="string">'flaskdb7'</span>,</span><br><span class="line">						   user=<span class="string">'root'</span>,</span><br><span class="line">						   password=<span class="string">'123456'</span>)</span><br><span class="line">	<span class="comment"># 获取游标</span></span><br><span class="line">	cursor = conn.cursor</span><br><span class="line">	<span class="comment"># 绑定全局变量，由于flask提供了一个g对象用于绑定全局变量</span></span><br><span class="line">	<span class="comment"># from flask import g</span></span><br><span class="line">	g.cursor = cursor</span><br><span class="line">	g.conn = conn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@blue.route('/sel_stu/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sel_stu</span><span class="params">()</span>:</span></span><br><span class="line">	sql = <span class="string">'select * from tb_student'</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 执行sql语句</span></span><br><span class="line">	g.cursor.execute(sql)</span><br><span class="line">	<span class="comment"># 获取查询结果</span></span><br><span class="line">	students = g.cursor.fetchall()</span><br><span class="line">	print(students)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="string">'查询成功'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里我们就用上面提到的teardwn_request来做关闭连接</span></span><br><span class="line"><span class="comment"># 无论程序运行情况怎么样我们都要关闭此次连接</span></span><br><span class="line"><span class="meta">@blue.teardown_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">close_mysql</span><span class="params">(e)</span>:</span></span><br><span class="line"></span><br><span class="line">	g.cursor.close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> e</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<strong>注意：应用上下文G对象</strong></p>
<pre><code>应用全局对象（g）是Flask为每一个请求自动建立的一个对象。g的作用范围只是在一个请求（也就是一个线程）里，它不能在多个请求中共享数据，故此应用全局变量（g）确保了线程安全。
</code></pre></div><div class="tags"><a href="/tags/Flask/">Flask</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2018/12/19/flask中通过ORM对数据库进行CRUD操作/" class="next">flask中通过ORM对数据库进行CRUD操作</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、模型关系定义"><span class="toc-text">一、模型关系定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-一对多"><span class="toc-text">1.1 一对多</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-一对一"><span class="toc-text">1.2 一对一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-多对多"><span class="toc-text">1.3 多对多</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、钩子函数"><span class="toc-text">二、钩子函数()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-before-request"><span class="toc-text">2.1 before_request</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-after-request"><span class="toc-text">2.2 after_request</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-teardown-request"><span class="toc-text">2.3 teardown_request</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-抛出异常"><span class="toc-text">2.4 抛出异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-异常捕获"><span class="toc-text">2.5 异常捕获</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-下面是一个连接数据库的实例"><span class="toc-text">2.6 下面是一个连接数据库的实例</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/20/flask模型关系与钩子函数/">flask模型关系与钩子函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/19/flask中通过ORM对数据库进行CRUD操作/">flask中通过ORM对数据库进行CRUD操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/15/centOS与Nginx与uWsgi部署Django项目/">centOS7+Nginx+uWsgi部署Django项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/10/rest-framework总结/">rest_framework总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/03/装饰器、中间件和Session/">装饰器、中间件和Session</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/30/cookie的使用/">cookie的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/29/模板基础/">模板基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/29/模型关系之一对多/">模型关系之一对多</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/28/ORM查询数据操作/">ORM查询数据操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/27/认识Django模型/">认识Django模型</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/Flask/" style="font-size: 15px;">Flask</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://www.jianshu.com/u/08d01ad78918" title="简书" target="_blank">简书</a><ul></ul><a href="https://github.com/NKactor/NKactor.github.io" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://gitee.com/nkactor/events" title="Gitee" target="_blank">Gitee</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">不知名的小演员.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>