<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人博客"><meta name="keywords" content="python, linux, mysql, django, 前端, css, javascript, html"><title>rest_framework总结 | NKactor</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">rest_framework总结</h1><a id="logo" href="/.">NKactor</a><p class="description">笨鸟先飞，滴水穿石</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">rest_framework总结</h1><div class="post-meta"><a href="/2018/12/10/rest-framework总结/#comments" class="comment-count"></a><p><span class="date">Dec 10, 2018</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p><strong>django-rest-framework,是一套基于Django 的 REST 框架，是一个强大灵活的构建 Web API 的工具包。 使用django-rest-framework实现前后分离。</strong></p>
<p>rest总结目录</p>
<ol>
<li>安装与配置</li>
<li>模型定义</li>
<li>路由</li>
<li>视图</li>
<li>序列化</li>
<li>条件过滤</li>
<li>增删改查方法自定义</li>
<li>to_representation方法</li>
<li>get_queryset方法</li>
<li>get_object方法</li>
</ol>
<h3 id="1-安装与配置"><a href="#1-安装与配置" class="headerlink" title="1. 安装与配置"></a>1. 安装与配置</h3><p>&emsp;&emsp;安装djangorestframework</p>
<blockquote>
<p>pip install djangorestframework==3.4.6</p>
</blockquote>
<p>&emsp;&emsp;安装过滤</p>
<blockquote>
<p>pip install django-filter</p>
</blockquote>
<p>&emsp;&emsp;配置settings.py文件</p>
<p>&emsp;&emsp;在工程目录中的settings.py文件的INSTALLED_APPS中需要添加rest_framework</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">    <span class="string">'rest_framework'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="2-模型定义"><a href="#2-模型定义" class="headerlink" title="2. 模型定义"></a>2. 模型定义</h3><p>&emsp;&emsp;定义文章模型类和文章分类的模型类，并指定分类和文章之间的一对多的关联关系<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">Atype</span>(<span class="title">models</span>.<span class="type">Model</span>):</span></span><br><span class="line"><span class="class">    t_name = models.<span class="type">CharField</span>(<span class="title">max_length</span>=10)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="keyword">class</span> <span class="type">Meta</span>:</span></span><br><span class="line"><span class="class">        db_table = 'a_type'</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">Article</span>(<span class="title">models</span>.<span class="type">Model</span>):</span></span><br><span class="line"><span class="class">    title = models.<span class="type">CharField</span>(<span class="title">max_length</span>=10)</span></span><br><span class="line"><span class="class">    desc = models.<span class="type">CharField</span>(<span class="title">max_length</span>=100)</span></span><br><span class="line"><span class="class">    content = models.<span class="type">TextField</span>()</span></span><br><span class="line"><span class="class">    is_delete = models.<span class="type">BooleanField</span>(<span class="title">default</span>=0)</span></span><br><span class="line"><span class="class">    create_time = models.<span class="type">DateTimeField</span>(<span class="title">auto_now_add</span>=<span class="type">True</span>)</span></span><br><span class="line"><span class="class">    atype = models.<span class="type">ForeignKey</span>(<span class="type">Atype</span>, <span class="title">null</span>=<span class="type">True</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="keyword">class</span> <span class="type">Meta</span>:</span></span><br><span class="line"><span class="class">        db_table = 'article'</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3-路由"><a href="#3-路由" class="headerlink" title="3. 路由"></a>3. 路由</h3><p>&emsp;&emsp;定义路由需要注意：</p>
<pre><code>使用router.register注册的url为资源，而且资源只能为名词不能为动词。
定义的资源不要加&apos;/&apos;斜杠，在访问地址的时候，URL中会默认的添加反斜杠&apos;/&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> SimpleRouter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入应用article中的views.py文件</span></span><br><span class="line"><span class="keyword">from</span> article <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成路由对象</span></span><br><span class="line">router = SimpleRouter()</span><br><span class="line"><span class="comment"># 路由管理资源art</span></span><br><span class="line">router.register(<span class="string">'art'</span>, views.ArticleView)</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'list/'</span>, views.list_art),</span><br><span class="line">]</span><br><span class="line"><span class="comment"># router.urls生成资源对应的路由地址</span></span><br><span class="line"><span class="comment"># 例如地址: /art/ 、 /art/id/</span></span><br><span class="line">urlpatterns += router.urls</span><br></pre></td></tr></table></figure>
<h3 id="4-视图"><a href="#4-视图" class="headerlink" title="4. 视图"></a>4. 视图</h3><p>&emsp;&emsp;定义基于类的视图ArticleView，可以通过继承父类来实现创建/检索/更新/删除等操作，而开发者只需要轻松地构造可重复使用的行为即可。而这些常见的创建/检索/更新/删除等操作是在REST框架的mixin类中实现的。</p>
<p>&emsp;&emsp;如下定义基于类的视图ArticleView，视图中实现序列化类ArticleSerializer和过滤类ArticleFiler:<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">from</span> rest_framework <span class="keyword">import</span> mixins, viewsets</span><br><span class="line"></span><br><span class="line"><span class="title">from</span> article.article_filter <span class="keyword">import</span> ArticleFiler</span><br><span class="line"><span class="title">from</span> article.article_serializer <span class="keyword">import</span> ArticleSerializer</span><br><span class="line"><span class="title">from</span> article.models <span class="keyword">import</span> Article</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">ArticleView</span>(<span class="title">viewsets</span>.<span class="type">GenericViewSet</span>,</span></span><br><span class="line"><span class="class">                  <span class="title">mixins</span>.<span class="type">ListModelMixin</span>,</span></span><br><span class="line"><span class="class">                  <span class="title">mixins</span>.<span class="type">DestroyModelMixin</span>,</span></span><br><span class="line"><span class="class">                  <span class="title">mixins</span>.<span class="type">CreateModelMixin</span>,</span></span><br><span class="line"><span class="class">                  <span class="title">mixins</span>.<span class="type">UpdateModelMixin</span>,</span></span><br><span class="line"><span class="class">                  <span class="title">mixins</span>.<span class="type">RetrieveModelMixin</span>):</span></span><br><span class="line"><span class="class">    # 查询返回的数据</span></span><br><span class="line"><span class="class">    queryset = <span class="type">Article</span>.objects.filter(<span class="title">is_delete</span>=0)</span></span><br><span class="line"><span class="class">    # 序列化返回的文章数据</span></span><br><span class="line"><span class="class">    serializer_class = <span class="type">ArticleSerializer</span></span></span><br><span class="line"><span class="class">    # 过滤</span></span><br><span class="line"><span class="class">    filter_class = <span class="type">ArticleFiler</span></span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;分析:</p>
<pre><code>queryset: 指明在查询数据时使用的查询集。
serializer_class: 指明该视图在进行序列化或反序列化时使用的序列化器。
filter_class: 指明过滤URL中传递参数的过滤器。
</code></pre><h3 id="5-序列化"><a href="#5-序列化" class="headerlink" title="5. 序列化"></a>5. 序列化</h3><p>&emsp;&emsp;定义序列化模型的ArticleSerializer类，并继承于serializers.ModelSerializer。其中可以自定义序列化字段的最大长度max_length和最小长度min_length以及错误信息的自定义error_messages。而fields字段表示序列化后用于展示的字段。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> article.models <span class="keyword">import</span> Article</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    desc = serializers.CharField(min_length=<span class="number">10</span>,</span><br><span class="line">                                 max_length=<span class="number">100</span>,</span><br><span class="line">                                 error_messages=&#123;</span><br><span class="line">                                     <span class="string">'required'</span>: <span class="string">'描述必填'</span>,</span><br><span class="line">                                     <span class="string">'max_length'</span>: <span class="string">'描述不超过100字符'</span>,</span><br><span class="line">                                     <span class="string">'min_length'</span>: <span class="string">'描述不少于10字符'</span></span><br><span class="line">                                 &#125;)</span><br><span class="line">    title = serializers.CharField(max_length=<span class="number">10</span>,</span><br><span class="line">                                  error_messages=&#123;</span><br><span class="line">                                      <span class="string">'required'</span>: <span class="string">'标题必填'</span>,</span><br><span class="line">                                  &#125;)</span><br><span class="line">    content = serializers.CharField(min_length=<span class="number">10</span>,</span><br><span class="line">                                    error_messages=&#123;</span><br><span class="line">                                      <span class="string">'required'</span>: <span class="string">'内容必填'</span>,</span><br><span class="line">                                    &#125;)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        <span class="comment"># 序列化的模型</span></span><br><span class="line">        model = Article</span><br><span class="line">        <span class="comment"># 需要序列化的字段</span></span><br><span class="line">        fields = [<span class="string">'title'</span>, <span class="string">'desc'</span>, <span class="string">'content'</span>, <span class="string">'id'</span>, <span class="string">'atype'</span>]</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;分析:</p>
<pre><code>model: 指明该序列化器处理的数据字段从模型类Article参考生成。
fields: 指明该序列化器包含模型类中的哪些字段，&apos;all&apos;指明包含所有字段。
</code></pre><h3 id="6-条件过滤"><a href="#6-条件过滤" class="headerlink" title="6. 条件过滤"></a>6. 条件过滤</h3><p>&emsp;&emsp;定义过滤模型的ArticleFiler类，并继承与filters.FilterSet。如下定义过滤的字段title、desc、content、min_time、max_time，且过滤的title、desc、content为模糊搜索。</p>
<p>&emsp;&emsp;定义如下的过滤字段，搜索的URL定义如下所示：</p>
<blockquote>
<p><a href="http://127.0.0.1/xxx/art/?title=小明&amp;desc=django&amp;content=学习&amp;max_time=2018-12-12&amp;min_time=2018-11-11。该URL表名模糊搜索标题title、desc、content，且创建时间大于2018-11-11且创建时间小于2018-12-12" target="_blank" rel="noopener">http://127.0.0.1/xxx/art/?title=小明&amp;desc=django&amp;content=学习&amp;max_time=2018-12-12&amp;min_time=2018-11-11。该URL表名模糊搜索标题title、desc、content，且创建时间大于2018-11-11且创建时间小于2018-12-12</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> filters</span><br><span class="line"><span class="keyword">import</span> django_filters</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> article.models <span class="keyword">import</span> Article</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleFiler</span><span class="params">(filters.FilterSet)</span>:</span></span><br><span class="line">    <span class="comment"># 过滤URL中title参数</span></span><br><span class="line">    title = django_filters.CharFilter(<span class="string">'title'</span>, lookup_expr=<span class="string">'contains'</span>)</span><br><span class="line">    <span class="comment"># 过滤URL中的desc参数</span></span><br><span class="line">    desc = django_filters.CharFilter(<span class="string">'desc'</span>, lookup_expr=<span class="string">'contains'</span>)</span><br><span class="line">    <span class="comment"># 过滤URL中的content参数</span></span><br><span class="line">    content = django_filters.CharFilter(<span class="string">'content'</span>, lookup_expr=<span class="string">'contains'</span>)</span><br><span class="line">    <span class="comment"># 过滤URL中时间最小值min_time</span></span><br><span class="line">    min_time = django_filters.DateTimeFilter(<span class="string">'create_time'</span>, lookup_expr=<span class="string">'gt'</span>)</span><br><span class="line">    <span class="comment"># 过滤URL中时间最大值max_time</span></span><br><span class="line">    max_time = django_filters.DateTimeFilter(<span class="string">'create_time'</span>, lookup_expr=<span class="string">'lt'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Article</span><br><span class="line">        fields = [<span class="string">'title'</span>, <span class="string">'desc'</span>, <span class="string">'content'</span>, <span class="string">'create_time'</span>]</span><br></pre></td></tr></table></figure>
<h3 id="7-增删改查方法自定义"><a href="#7-增删改查方法自定义" class="headerlink" title="7. 增删改查方法自定义"></a>7. 增删改查方法自定义</h3><p>&emsp;&emsp;mixins在djangorestframework中主要配合viewsets共同使用，实现http方法与mixins的相关类与方法进行关联。djangorestframework中有5类Minxin，他们与http方法对应如下:</p>
<table>
<thead>
<tr>
<th style="text-align:center">mixins</th>
<th style="text-align:center">作用</th>
<th style="text-align:center">对应的请求方式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">mixins.ListModelMixin</td>
<td style="text-align:center">定义一个list方法，返回一个queryset的列表</td>
<td style="text-align:center">Get</td>
</tr>
<tr>
<td style="text-align:center">mixins.CreateModelMixin</td>
<td style="text-align:center">定义一个create方法，创建一个实例</td>
<td style="text-align:center">Post</td>
</tr>
<tr>
<td style="text-align:center">mixins.RetriverModelMixin</td>
<td style="text-align:center">定义一个retrieve方法，返回一个具体的实例</td>
<td style="text-align:center">Get</td>
</tr>
<tr>
<td style="text-align:center">mixins.UpdateModelMixin</td>
<td style="text-align:center">定义一个update方法，对某个实例进行更新</td>
<td style="text-align:center">Put/Patch</td>
</tr>
<tr>
<td style="text-align:center">mixins.DestoryModelMixin</td>
<td style="text-align:center">定义一个delete方法，删除某个实例</td>
<td style="text-align:center">Delete</td>
</tr>
</tbody>
</table>
<p>&emsp;&emsp;具体分析：</p>
<h4 id="7-1-CreateModelMixin"><a href="#7-1-CreateModelMixin" class="headerlink" title="7.1 CreateModelMixin"></a>7.1 CreateModelMixin</h4><p>&emsp;&emsp;源码:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateModelMixin</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Create a model instance ==&gt;创建一个实例</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取相关serializer</span></span><br><span class="line">        serializer = self.get_serializer(data=request.data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 进行serializer的验证</span></span><br><span class="line">        <span class="comment"># raise_exception=True,一旦验证不通过，不再往下执行，直接引发异常</span></span><br><span class="line">        serializer.is_valid(raise_exception=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 调用perform_create()方法，保存实例</span></span><br><span class="line">        self.perform_create(serializer)</span><br><span class="line"></span><br><span class="line">        headers = self.get_success_headers(serializer.data)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_201_CREATED, headers=headers)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perform_create</span><span class="params">(self, serializer)</span>:</span></span><br><span class="line">    <span class="comment"># 保存实例</span></span><br><span class="line">        serializer.save()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_success_headers</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">'Location'</span>: str(data[api_settings.URL_FIELD_NAME])&#125;</span><br><span class="line">        <span class="keyword">except</span> (TypeError, KeyError):</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;创建的逻辑思路图如下:<br><img src="https://upload-images.jianshu.io/upload_images/14187443-49d7b74e0b1dae56.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="drf_create.png"></p>
<p>&emsp;&emsp;分析: 由上图可以看出这个类的一个逻辑，其中，perform_create( )对serializer直接进行save保存，当在一些情境下，我们需要对perform_create( )进行重写。</p>
<p>&emsp;&emsp;那么我们现在可能有一个下面的需要：</p>
<p>&emsp;&emsp;假设现在有一个course课程model，里面维持了一个数，记录课程收藏数，还存在一个用户收藏userfav的model(外键course指向课程模型)，当一个用户对课程进行收藏，理论上现在post进来的应该是userfav的instance，显然，我们还需要对相应course的收藏数fav_num进行+1。 这个时候，我们就需要重写perform_create( )方法！</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def perform_create(self, serializer):</span><br><span class="line">    # 重写save的逻辑</span><br><span class="line">   <span class="built_in"> instance </span>= serializer.save()</span><br><span class="line">    course = instance.course</span><br><span class="line">    course.fav_num += 1</span><br><span class="line">    course.save()</span><br></pre></td></tr></table></figure>
<h4 id="7-2-ListModelMixin"><a href="#7-2-ListModelMixin" class="headerlink" title="7.2 ListModelMixin"></a>7.2 ListModelMixin</h4><p>&emsp;&emsp;源码:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class ListModelMixin(object):</span><br><span class="line">    <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    List a queryset.==&gt; 列表页获取</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    def list(self, request, <span class="number">*a</span>rgs, **kwargs):</span><br><span class="line">        queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line"></span><br><span class="line">        # 这是一个分页功能，如果在viewset中设置了pagination_class，那么这里就会起作用</span><br><span class="line">        # 获取当前页的queryset，如果不存在分页，返回None</span><br><span class="line">       <span class="built_in"> page </span>= self.paginate_queryset(queryset)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span><span class="built_in"> page </span>is <span class="keyword">not</span> None:</span><br><span class="line">        # 分页不为空，那么不能简单的执行Response(serializer.data)</span><br><span class="line">        # 还需要将相关的page信息序列化在进行响应</span><br><span class="line">            serializer = self.get_serializer(page, <span class="attribute">many</span>=<span class="literal">True</span>)</span><br><span class="line">            return self.get_paginated_response(serializer.data)</span><br><span class="line"></span><br><span class="line">        serializer = self.get_serializer(queryset, <span class="attribute">many</span>=<span class="literal">True</span>)</span><br><span class="line">        return Response(serializer.data)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>分析: ListModelMixin一般用来获取列表页，大多数情况下比较简单，不需要重写相关的方法。</p>
</blockquote>
<h4 id="7-3-RetrieveModelMixin"><a href="#7-3-RetrieveModelMixin" class="headerlink" title="7.3 RetrieveModelMixin"></a>7.3 RetrieveModelMixin</h4><p>&emsp;&emsp;源码:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RetrieveModelMixin</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Retrieve a model instance.==&gt; 获取某一个对象的具体信息</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">retrieve</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># 一般访问的url都为/obj/id/这种新式</span></span><br><span class="line">        <span class="comment"># get_object()可以获取到这个id的对象</span></span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        serializer = self.get_serializer(instance)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;分析: 访问的URL都为/obj/id/这种新式才会调用该retrieve方法，其中get_object()可以获取到这个id的对象。开发中对retrieve这个方法的重写几率比较高，例如我们在增加点击数的时候，经常要对其进行一个重写。</p>
<h4 id="7-4-UpdateModelMixin"><a href="#7-4-UpdateModelMixin" class="headerlink" title="7.4 UpdateModelMixin"></a>7.4 UpdateModelMixin</h4><p>&emsp;&emsp;源码:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdateModelMixin</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Update a model instance.==&gt; 更新某个具体对象的内容</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        partial = kwargs.pop(<span class="string">'partial'</span>, <span class="keyword">False</span>)</span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        serializer = self.get_serializer(instance, data=request.data, partial=partial)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="keyword">True</span>)</span><br><span class="line">        self.perform_update(serializer)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> getattr(instance, <span class="string">'_prefetched_objects_cache'</span>, <span class="keyword">None</span>):</span><br><span class="line">            <span class="comment"># If 'prefetch_related' has been applied to a queryset, we need to</span></span><br><span class="line">            <span class="comment"># forcibly invalidate the prefetch cache on the instance.</span></span><br><span class="line">            instance._prefetched_objects_cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perform_update</span><span class="params">(self, serializer)</span>:</span></span><br><span class="line">        serializer.save()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partial_update</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        kwargs[<span class="string">'partial'</span>] = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">return</span> self.update(request, *args, **kwargs)</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;分析: UpdateModelMixin实现逻辑基本整合了Create以及Retrieve，先得到具体的实例，再对其进行验证以及保存，如果需要对更新这个逻辑进行自定义，那么需要重写perform_update( )方法，而尽量少去重写update( )</p>
<h4 id="7-5-DestroyModelMixin"><a href="#7-5-DestroyModelMixin" class="headerlink" title="7.5 DestroyModelMixin"></a>7.5 DestroyModelMixin</h4><p>&emsp;&emsp;源码:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DestroyModelMixin</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Destroy a model instance.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">destroy</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        self.perform_destroy(instance)</span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perform_destroy</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        instance.delete()</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;DestroyModelMixin的逻辑也相对比较简单，当删除文章对象数据时，通过修改模型中的定义的is_delete字段，将is_delete字段置为1表示删除数据,这是逻辑删除，并不是物理删除。因此重构perform_destroy方法，如下:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">perform_destroy</span><span class="params">(<span class="keyword">self</span>, instance)</span></span><span class="symbol">:</span></span><br><span class="line">    instance.is_delete = <span class="number">1</span></span><br><span class="line">    instance.save()</span><br></pre></td></tr></table></figure></p>
<h3 id="8-to-representation方法"><a href="#8-to-representation方法" class="headerlink" title="8. to_representation方法"></a>8. to_representation方法</h3><p>&emsp;&emsp;概念:序列化器的每个字段实际都是由该字段类型的to_representation方法决定格式的，可以通过重写该方法来决定格式。</p>
<p>&emsp;&emsp;如下重定义to_representation方法，把每一列数据（其中instance代表每一列数据）进行修改重组，然后返回，如下示例将返回文章的类型字段进行修改再填充回数据中进行返回。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> article.models <span class="keyword">import</span> Article</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    desc = serializers.CharField(min_length=<span class="number">10</span>,</span><br><span class="line">                                 max_length=<span class="number">100</span>,</span><br><span class="line">                                 error_messages=&#123;</span><br><span class="line">                                     <span class="string">'required'</span>: <span class="string">'描述必填'</span>,</span><br><span class="line">                                     <span class="string">'max_length'</span>: <span class="string">'描述不超过100字符'</span>,</span><br><span class="line">                                     <span class="string">'min_length'</span>: <span class="string">'描述不少于10字符'</span></span><br><span class="line">                                 &#125;)</span><br><span class="line">    title = serializers.CharField(max_length=<span class="number">10</span>,</span><br><span class="line">                                  error_messages=&#123;</span><br><span class="line">                                      <span class="string">'required'</span>: <span class="string">'标题必填'</span>,</span><br><span class="line">                                  &#125;)</span><br><span class="line">    content = serializers.CharField(min_length=<span class="number">10</span>,</span><br><span class="line">                                    error_messages=&#123;</span><br><span class="line">                                      <span class="string">'required'</span>: <span class="string">'内容必填'</span>,</span><br><span class="line">                                    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        <span class="comment"># 序列化的模型</span></span><br><span class="line">        model = Article</span><br><span class="line">        <span class="comment"># 需要序列化的字段</span></span><br><span class="line">        fields = [<span class="string">'title'</span>, <span class="string">'desc'</span>, <span class="string">'content'</span>, <span class="string">'id'</span>, <span class="string">'atype'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_representation</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        <span class="comment"># 序列化是会默认调用该方法，返回的结果为当前instance对象的序列化结果</span></span><br><span class="line">        data = super().to_representation(instance)</span><br><span class="line">        <span class="keyword">if</span> instance.atype:</span><br><span class="line">            data[<span class="string">'atype'</span>] = instance.atype.t_name</span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure></p>
<h3 id="9-get-queryset方法"><a href="#9-get-queryset方法" class="headerlink" title="9. get_queryset方法"></a>9. get_queryset方法</h3><p>&emsp;&emsp;get_queryset(self)：返回视图使用的查询集，是列表视图与详情视图获取数据的基础，默认返回queryset属性，可以重写，例如对查询结果集进行再次过滤，可以重写如下：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">    queryset = <span class="keyword">self</span>.queryset</span><br><span class="line">    <span class="keyword">return</span> queryset.filter(title__contains=<span class="string">'django学习day01'</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="10-get-object方法"><a href="#10-get-object方法" class="headerlink" title="10. get_object方法"></a>10. get_object方法</h3><p>&emsp;&emsp;get_object(self): 返回详情视图所需的模型类数据对象。在视图中可以调用该方法获取详情信息的模型类对象。若详情访问的模型类对象不存在，会返回404。</p>
</div><div class="tags"><a href="/tags/Django/">Django</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2018/12/15/centOS与Nginx与uWsgi部署Django项目/" class="pre">centOS7+Nginx+uWsgi部署Django项目</a><a href="/2018/12/03/装饰器、中间件和Session/" class="next">装饰器、中间件和Session</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-安装与配置"><span class="toc-text">1. 安装与配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-模型定义"><span class="toc-text">2. 模型定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-路由"><span class="toc-text">3. 路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-视图"><span class="toc-text">4. 视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-序列化"><span class="toc-text">5. 序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-条件过滤"><span class="toc-text">6. 条件过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-增删改查方法自定义"><span class="toc-text">7. 增删改查方法自定义</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-CreateModelMixin"><span class="toc-text">7.1 CreateModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-ListModelMixin"><span class="toc-text">7.2 ListModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-RetrieveModelMixin"><span class="toc-text">7.3 RetrieveModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-UpdateModelMixin"><span class="toc-text">7.4 UpdateModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-DestroyModelMixin"><span class="toc-text">7.5 DestroyModelMixin</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-to-representation方法"><span class="toc-text">8. to_representation方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-get-queryset方法"><span class="toc-text">9. get_queryset方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-get-object方法"><span class="toc-text">10. get_object方法</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/20/flask模型关系与钩子函数/">flask模型关系与钩子函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/19/flask中通过ORM对数据库进行CRUD操作/">flask中通过ORM对数据库进行CRUD操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/15/centOS与Nginx与uWsgi部署Django项目/">centOS7+Nginx+uWsgi部署Django项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/10/rest-framework总结/">rest_framework总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/03/装饰器、中间件和Session/">装饰器、中间件和Session</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/30/cookie的使用/">cookie的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/29/模板基础/">模板基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/29/模型关系之一对多/">模型关系之一对多</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/28/ORM查询数据操作/">ORM查询数据操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/27/认识Django模型/">认识Django模型</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/Flask/" style="font-size: 15px;">Flask</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://www.jianshu.com/u/08d01ad78918" title="简书" target="_blank">简书</a><ul></ul><a href="https://github.com/NKactor/NKactor.github.io" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://gitee.com/nkactor/events" title="Gitee" target="_blank">Gitee</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">不知名的小演员.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>